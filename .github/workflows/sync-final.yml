name: Sync All Public Images

on:
  workflow_dispatch:

jobs:
  push-ghcr:
    runs-on: ubuntu-latest
    steps:
      - name: Log in to GHCR
        run: echo "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" | docker login ghcr.io -u flyhare-coder --password-stdin

      - name: Sync Master List
        run: |
          declare -A images=(
            ["xhofe/alist:latest"]="my-alist"
            ["imputnet/cobalt:latest"]="my-cobalt"
            ["alexta69/metube:latest"]="my-metube"
            ["sevenyc/video-decode:latest"]="my-vapi"
            ["louislam/uptime-kuma:latest"]="my-uptime-kuma"
            ["vaultwarden/server:latest"]="my-vaultwarden"
            # ä¸‹é¢è¿™äº›æ˜¯æ€€ç–‘å¯¹è±¡ï¼ŒåŠ ä¸Š || true ä¿è¯æŠ¥é”™ä¹Ÿä¸æ–­æ‰
          )

          for src in "${!images[@]}"; do
            dst=${images[$src]}
            echo "ğŸ”¥ æ­£åœ¨åŒæ­¥: $src"
            
            # å¦‚æœ pull å¤±è´¥ï¼Œè®°å½•ä¸€ä¸‹ä½†ä¸é€€å‡ºè„šæœ¬
            if docker pull $src; then
              docker tag $src ghcr.io/flyhare-coder/$dst:latest
              docker push ghcr.io/flyhare-coder/$dst:latest
              docker rmi $src ghcr.io/flyhare-coder/$dst:latest
              echo "âœ… $src åŒæ­¥æˆåŠŸ"
            else
              echo "âŒ $src é•œåƒåœ°å€ä¸å¯¹ï¼Œå·²è·³è¿‡"
            fi
          done
