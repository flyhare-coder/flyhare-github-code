name: Bulk Delete Packages

on:
  workflow_dispatch:

jobs:
  delete-pkgs:
    runs-on: ubuntu-latest
    steps:
      - name: Delete All
        run: |
          TOKEN="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"
          USER="flyhare-coder"
          
          # 1. 自动抓取你名下所有的 21 个镜像名
          PKGS=$(curl -s -H "Authorization: Bearer $TOKEN" \
            "https://api.github.com/users/$USER/packages?package_type=container" | jq -r '.[].name')

          # 2. 循环彻底删除
          for PKG in $PKGS; do
            echo "正在销毁旧镜像: $PKG"
            curl -L -X DELETE \
              -H "Accept: application/vnd.github+json" \
              -H "Authorization: Bearer $TOKEN" \
              "https://api.github.com/user/packages/container/$PKG"
          done
          echo "所有私有镜像已清空！"
